{% extends "agent/base.html" %}
{% block content %}

<div class="container-fluid mt-4">

  <!-- ================= HEADER ================= -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h4 class="fw-bold mb-0">üßæ All Bills</h4>
      <small class="text-muted">
        Monthly bills generated for customers
      </small>
    </div>

    <div class="d-flex gap-2">
      <a href="/agent/bills/create/"
         class="btn btn-sm btn-primary">
        ‚ûï Create Bill
      </a>

      <a href="/agent/dashboard"
         class="btn btn-sm btn-outline-secondary">
        ‚Üê Back
      </a>
    </div>
  </div>

  <!-- ================= SUMMARY CARDS ================= -->
  <div class="row mb-4">

    <div class="col-md-3">
      <div class="card shadow-sm text-center">
        <div class="card-body">
          <h6 class="text-muted">Total Bills</h6>
          <h4 class="fw-bold">{{ total_bills }}</h4>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm text-center">
        <div class="card-body">
          <h6 class="text-muted">Total Amount</h6>
          <h4 class="fw-bold">‚Çπ {{ total_amount }}</h4>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm text-center">
        <div class="card-body">
          <h6 class="text-muted">Paid Amount</h6>
          <h4 class="fw-bold text-success">‚Çπ {{ paid_amount }}</h4>
        </div>
      </div>
    </div>

    <div class="col-md-3">
      <div class="card shadow-sm text-center">
        <div class="card-body">
          <h6 class="text-muted">Pending Amount</h6>
          <h4 class="fw-bold text-danger">‚Çπ {{ pending_amount }}</h4>
        </div>
      </div>
    </div>

  </div>

  <!-- ================= BILLS TABLE ================= -->
  <div class="card shadow-sm">
    <div class="card-body table-responsive p-0">

      <table class="table table-bordered table-hover mb-0 text-center align-middle">
        <thead class="table-dark">
          <tr>
            <th>#</th>
            <th>Customer</th>
            <th>Month</th>
            <th>Year</th>
            <th>Delivery Days</th>
            <th>Base Amount</th>
            <th>Late Charges</th>
            <th>Total</th>
            <th>Status</th>
            <th>Created</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
        {% for bill in bills %}
          <tr>
            <td>{{ forloop.counter }}</td>

            <td>
              {{ bill.customer.name }} {{ bill.customer.surname }}
            </td>

            <td>{{ bill.month }}</td>
            <td>{{ bill.year }}</td>

            <td>{{ bill.total_delivery_days }}</td>

            <td>‚Çπ {{ bill.base_amount }}</td>

            <td class="text-danger">
              ‚Çπ {{ bill.late_charges }}
            </td>

            <td class="fw-bold">
              ‚Çπ {{ bill.total_amount }}
            </td>

            <td>
              {% if bill.is_paid %}
                <span class="badge bg-success">Paid</span>
              {% else %}
                <span class="badge bg-warning text-dark">Pending</span>
              {% endif %}
            </td>

            <td>
              {{ bill.created_at|date:"d M Y" }}
            </td>

            <!-- ===== ACTIONS ===== -->
            <td>
              <div class="d-flex justify-content-center gap-1">

                <!-- Edit -->
                <a href="/agent/bills/{{ bill.id }}/edit/"
                   class="btn btn-sm btn-outline-primary"
                   title="Edit Bill">
                  ‚úèÔ∏è
                </a>

                <!-- Delete -->
                <a href="/agent/bills/{{ bill.id }}/delete/"
                   class="btn btn-sm btn-outline-danger"
                   title="Delete Bill"
                   onclick="return confirm('Are you sure you want to delete this bill?');">
                  üóëÔ∏è
                </a>

              </div>
            </td>

          </tr>
        {% empty %}
          <tr>
            <td colspan="11" class="text-muted py-3">
              No bills generated yet
            </td>
          </tr>
        {% endfor %}
        </tbody>

      </table>

    </div>
  </div>

</div>

{% endblock %}
