{% extends "agent/base.html" %}
{% block content %}

<div class="container mt-4" id="printArea">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h4 class="fw-bold mb-0">üí≥ All Payments</h4>
      <small class="text-muted">
        Payments made to all Hokers
      </small>
    </div>

    <div class="d-flex gap-2 align-items-center">
      <!-- üîç Search -->
      <input
        type="text"
        id="searchInput"
        class="form-control form-control-sm no-print"
        placeholder="üîç Search hoker / mobile"
        onkeyup="searchTable()"
        style="width:200px;"
      >

      <!-- üñ®Ô∏è Print -->
      <button onclick="printBill()" class="btn btn-sm btn-outline-primary">
        üñ®Ô∏è Print Bill
      </button>

      <!-- Back -->
      <a href="/agent/dashboard"
         class="btn btn-sm btn-outline-secondary">
        ‚Üê Back
      </a>
    </div>
  </div>

  <!-- Payments Table -->
  <div class="card shadow-sm">
    <div class="card-body p-0">

      <table class="table table-bordered mb-0" id="paymentTable">
        <thead class="table-light">
          <tr>
            <th>#</th>
            <th>Date</th>
            <th>Hoker Name</th>
            <th>Mobile</th>
            <th>Amount (‚Çπ)</th>
            <th>Remarks</th>
          </tr>
        </thead>

        <tbody>
          {% for pay in payments %}
          <tr>
            <td>{{ forloop.counter }}</td>
            <td>{{ pay.date }}</td>
            <td>{{ pay.hoker.full_name }}</td>
            <td>{{ pay.hoker.mobile }}</td>
            <td>‚Çπ {{ pay.amount }}</td>
            <td>{{ pay.remarks|default:"‚Äî" }}</td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center text-muted">
              No payments found
            </td>
          </tr>
          {% endfor %}
        </tbody>

        {% if payments %}
        <tfoot class="table-light">
          <tr>
            <th colspan="4" class="text-end">Total Paid</th>
            <th colspan="2">‚Çπ {{ total_paid }}</th>
          </tr>
        </tfoot>
        {% endif %}
      </table>

    </div>
  </div>

</div>

<!-- JS -->
<script>
function searchTable() {
  const input = document.getElementById("searchInput").value.toLowerCase();
  const rows = document.querySelectorAll("#paymentTable tbody tr");

  rows.forEach(row => {
    const text = row.innerText.toLowerCase();
    row.style.display = text.includes(input) ? "" : "none";
  });
}

function printBill() {
  const content = document.getElementById("printArea").innerHTML;
  const original = document.body.innerHTML;

  document.body.innerHTML = content;
  window.print();
  document.body.innerHTML = original;
  location.reload();
}
</script>

<!-- Print CSS -->
<style>
@media print {
  body {
    background: #fff;
  }
  .btn, a, .no-print {
    display: none !important;
  }
}
</style>

{% endblock %}
